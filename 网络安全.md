#### 1 xss 跨脚本攻击

允许攻击者将恶意代码植入到提供给其他用户使用的页面中  
xss 的攻击目标是为了盗取存储在客户端的 cookie 或者其他网站用于识别客户端身份的敏感信息。一旦获取到合法用户的信息后，攻击者甚至可以假冒合法用户与网站进行交互例子：

```html
<input type="text" value="<%= getParameter("keyword") %>">
<button>搜索</button>
<div>您搜索的关键词是：<%= getParameter("keyword") %></div>

<input type="text" value="" />
<script>
  alert('XSS');
</script>
">
<button>搜索</button>
<div>
  您搜索的关键词是：">
  <script>
    alert('XSS');
  </script>
</div>
```

用户输入 `<script>alert('XSS');</script>`，浏览器无法分辨是恶意代码，因而会直接执行  
分为三类

##### 存储型 xss

存储型 xss 的攻击步骤：

1. 攻击者将恶意代码提交到目标网站的数据库中
2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 html 中返回给浏览器
3. 用户浏览器收到响应后执行恶意代码
4. 恶意代码会窃取用户数据并大送到攻击者的网站，或者冒充用户的行为，调用目标网站接口攻击

这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等

##### 反射型 xss

反射型 xss 的攻击步骤：

1. 攻击者构造出特殊的 url，其中包含恶意代码
2. 用户打开带有恶意代码的 url 时，网站服务端将恶意代码从 url 中取出，拼接在 html 中返回给浏览器
3. 用户浏览器接收到响应后解析执行，恶意代码也会执行
4. 恶意代码会窃取用户数据并大送到攻击者的网站，或者冒充用户的行为，调用目标网站接口攻击

反射型 xss 和存储型 xss 的区别是：存储型 xss 的恶意代码存在数据库中，反射型 xss 的恶意代码存在 url 中  
反射型 xss 漏洞常见于通过 url 传递参数的功能，如网站搜索、跳转等。  
由于需要用户主动打开恶意的 url 才能生效，攻击者往往会结合多种手段诱导用户点击。

##### dom 型 xss

dom 型 xss 跟前两总 xss 的区别：dom 型 xss 攻击中，取出和执行恶意代码都有浏览器端完成，属于前端 js 自身的安全漏洞，而其他两中 xss 都属于服务端的安全漏洞

##### 预防攻击

xss 攻击的两大要素：

1. 攻击者提交恶意代码
2. 浏览器执行恶意代码

针对第一个要素，我们可以对用户的代码进行过滤，但是该方法并不可靠

1. 利用模板引擎  
   开启模板引擎的 html 转义功能
2. 避免内联事件  
   尽量不要使用`onLoad="onload()"`或者`onclick=""`这种拼接内联事件的写法
3. 避免拼接 html  
   前端采用拼接 html 的方法比较危险，如果框架允许，采用 createElement、setAttribute 之类的方法实现。或者采用比较成熟的渲染框架，如 vue 等。
4. 时刻保持警惕  
   在插入位置为 dom 属性、链接等位置时，要严加防范。
5. 增加攻击难度，降低攻击后果  
   通过对输入长度限制、接口安全措施等方法，增加攻击的难度，降低攻击的后果。
6. 主动检测和发现  
   可使用 xss 攻击字符串和自动扫描工具寻找潜在的 xss 漏洞
7. cookie 设置 http-only

#### 2 csrf 跨站请求伪造

攻击者诱导受害者进入第三方网站，在第三方网站中，向北攻击网站发送跨站请求  
利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作目的  
典型的 csrf 攻击流程

1. 受害者登录 a.com，并保留了登录凭证 cookie
2. 攻击者引诱受害者访问了 b.com
3. b.com 向 a.com 发送了一个请求：a.com/act=xx。浏览器会默认携带 a.com 的 cookie
4. a.com 接收到请求后，对请求验证，并确认是受害者的凭证，误认为是受害者自己发送的请求
5. a.com 以受害者的名义执行了 act=xx
6. 攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让 a.com 执行了自己定义的操作

#### 3 sql 注入

sql 注入攻击，是通过将恶意的 sql 查询或添加语句插入到应用的输入参数中，再在后台 sql 服务器上解析执行进行的攻击

流程如下：

1. 找出 sql 漏洞的注入点
2. 判断数据库的类型以及版本
3. 猜解用户名和密码
4. 利用攻击查找 web 后台管理入口
5. 入侵和破坏

预防方式：

1. 严格检查输入变量的类型和格式
2. 过滤和转义特殊字符
3. 对访问数据库的 web 应用程序采用 web 应用防火墙
